/**
This is I-Don't-Have-A-Fuckin-Clue-ware
*/((function(){"use strict";var a,b,c,d,e,f=Array.prototype.slice,g=Object.prototype.hasOwnProperty,h=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(g.call(this,b)&&this[b]===a)return b;return-1};a=jQuery.sub(),jQuery.expr[":"].htmleditable=function(b){var c;return c=a(b),c.is('[contenteditable="true"]')&&c.data("htmleditable")!=null},a.fn.originalHtml=a.fn.html,jQuery.fn.html=function(){var b;return this.eq(0).is(":htmleditable")?this.htmleditable.apply(this,["value"].concat(f.call(arguments))):(b=a(this)).originalHtml.apply(b,arguments)},jQuery.fn.htmleditable=a.pluginify({init:function(b,e){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=this;jQuery.isReady||a.error("Initialization of htmleditable is not possible before the document is ready. Have you placed your code in a 'ready' handler?");if(a(this).closest(":htmleditable").length>0||a(this).parents('[contenteditable="true"]').length>0)return this;arguments.length<2&&a.isArray(b)&&(e=b,b=void 0),b==null&&(b="native"),e=a.merge([b,"base"],e!=null?e:[]),rangy.init(),l=a.merge([],e);for(p=0,s=e.length;p<s;p++){i=e[p],x=(v=(w=jQuery.htmleditable[i])!=null?w.condition:void 0)!=null?v:[];for(q=0,t=x.length;q<t;q++){g=x[q],g[0]==="-"?(n=!1,g=g.slice(1)):n=!0;if(h.call(l,g)>=0!==n){for(;;){j=a.inArray(i,l);if(j===-1)break;l.splice(j,1)}break}}}e={};for(r=0,u=l.length;r<u;r++)k=l[r],e[k]=jQuery.htmleditable[k];a(this).data("htmleditable",{features:e}).attr("contenteditable",!0).bind("paste",function(b){var e,f=this;e=rangy.saveSelection(),d().focus();try{document.execCommand("Paste")!==!1&&b.preventDefault()}catch(g){}return setTimeout(function(){var b,g;a(f).focus(),b=c.call(a(f),d()[0]),d().empty().append(b),g=d().html(),d().empty(),rangy.restoreSelection(e);try{return document.execCommand("insertHTML",void 0,g)}catch(h){return document.selection.createRange().pasteHTML(g)}})}).bind("input",function(){return a(this).updateValue()}).bind("change mouseup touchend focus blur",function(){return a(this).updateState()}).bind("keydown",function(){var b=this;return setTimeout(function(){return a(b).updateState()})});try{document.execCommand("styleWithCSS",void 0,!1)}catch(A){}a(this).updateState(),a(this).htmleditable("value",a(this).originalHtml()),y=a(this).data("htmleditable").features,o=function(b,c){var d,e,g,h,i;(g=c.init)!=null&&g.call(a(z)),h=c.hotkeys,i=[];for(e in h)d=h[e],i.push(a(z).bind("keydown",e,function(c){var e;return c.preventDefault(),c.stopPropagation(),(e=a(this)).htmleditable.apply(e,["command",b].concat(f.call(d)))}));return i};for(m in y)i=y[m],o(m,i);return this},value:function(b){var e,f,g=this;return b==null?a(this).data("htmleditable").value:(b=b.replace(/^([\s\S]*)<!--htmleditable:state\s([\s\S]*?)-->([\s\S]*)$/g,function(b,c,d,e){var f,h,i,j,k;f=a(g).data("htmleditable").features,j=a.parseJSON("{ "+d+" }");for(h in j)i=j[h],((k=f[h])!=null?k.content:void 0)===!0&&a(g).htmleditable("command",h,i);return c+e}),d().html(b),e=c.call(a(this),d()[0]),d().empty(),f=a(this).empty().append(e),a(this).updateValue(),f)},state:function(b){var c,d,e,f,g,h;e=(h=a(this).data("htmleditable"))!=null?h.state:void 0;if(e==null)return e;if(typeof b=="string")return e[b];if(b!=null?!b.length:!void 0)return a.extend({},e);d={};for(f=0,g=b.length;f<g;f++)c=b[f],d[c]=e[c];return d},command:function(){var b,c,d,e,g;return c=arguments[0],b=2<=arguments.length?f.call(arguments,1):[],e={},d=a(this).data("htmleditable").features[c],"command"in d?(g=d.command).call.apply(g,[a(this)].concat(f.call(b))):e[c]=b[0],a(this).updateState(e),a(this).updateValue(),this},selection:function(b){var c,d,e,f;if(arguments.length>0)return(b!=null?b.nodeType:void 0)===1&&(d=rangy.createRange(),d.selectNodeContents(b),b=d),rangy.getSelection().setSingleRange(b),a(this).updateState(),this;f=rangy.getSelection();if(f.rangeCount!==1)return;b=f.getRangeAt(0),e=rangy.createRange(),e.selectNodeContents(this),c=e.intersection(b);if(c===null||!c.equals(b))return;return b}}),(e=jQuery.htmleditable)==null&&(jQuery.htmleditable={}),c=function(b){var c,d;return c=this.data("htmleditable").features,d=function(e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;f=e===b?a():a(e);if(e.nodeType===1){h=document.createDocumentFragment(),s=e.childNodes;for(q=0,r=s.length;q<r;q++)g=s[q],l=d.call(this,g),l!=null&&h.appendChild(l);o=function(){var a;a=[];for(m in c)j=c[m],a.push(j.element);return a}(),k=0,i=void 0;while(k<o.length)n=o[k++],p=n!=null?n.call(f,i,h):void 0,a.isFunction(p)?o.push(p):p!=null&&(i=p);return i!=null&&(h.hasChildNodes()&&i.appendChild(h),h=i),h}if(e.nodeType===3)return f.clone(!1,!1)[0]},d.call(this,b)},a.fn.updateValue=function(){var b,c,d,e,f,g,h,i,j,k;d=this.data("htmleditable"),h=d.features;for(f in h)e=h[f],(i=e.change)!=null&&i.call(this);b=this.clone(!1,!1),g={},j=d.features;for(f in j)e=j[f],(k=e.output)!=null&&k.call(this,b),e.content===!0&&(g[f]=this.htmleditable("state",f));c=b.html(),a.isEmptyObject(g)||(g=JSON.stringify(g),c="<!--htmleditable:state "+g.slice(1,g.length-1)+" -->"+c);if(d.value!==c)return d.value=c,this.change()},a.fn.updateState=function(b){var c,d,e,f,g,h,i,j,k,l,m,n;j=this.htmleditable("selection"),g={},l=this.data("htmleditable").features;for(i in l)e=l[i],f=e!=null?(m=e.state)!=null?m.call(this):void 0:void 0,f!==void 0&&(a.isPlainObject(f)||(k=f,(f={})[i]=k),a.extend(g,f));a.extend(g,b),c=this.data("htmleditable"),(n=c.state)==null&&(c.state={}),d={};for(h in g)k=g[h],c.state[h]!==k&&(c.state[h]=k,d[h]=k);if(!a.isEmptyObject(d))return this.trigger("state",d)},b=a(),d=function(){return b.length!==1&&(b=a('<div contenteditable="true" tabindex="-1" style="position: absolute; top: -100px; left: -100px; width: 1px; height: 1px; overflow: hidden;" />').prependTo("body")),b},jQuery.fn.domSplice=function(b){var c;return c=[],this.each(function(){var d,e;return b&&(d=a(b),c.push.apply(c,d.get())),this.nodeType!==1||(e=this.nodeName.toLowerCase())!=="style"&&e!=="script"&&e!=="iframe"?b?(d.insertBefore(this).prepend(a(this).contents()),a(this).remove()):a(this).replaceWith(a(this).contents()):b?a(this).replaceWith(d):a(this).remove()}),a(c)}})).call(this),function(){var a;a=jQuery,a.htmleditable["native"]={element:function(a){var b;if(a!=null)return;if(!(!this.is("p, div, br")||(b=this.prop("scopeName"))!==void 0&&b!=="HTML"))return document.createElement(this[0].nodeName);if(this.is(":header"))return function(a){if(a!=null)return;return document.createElement("p")}}}}.call(this),function(){var a;a=jQuery,a.htmleditable.linebreaks={element:function(b){var c,d,e;if(this.length===0||b!=null)return;if(this.is("br"))return document.createElement("br");if(!(!this.is("p, :header")||(c=(d=this.prop("prefix"))!=null?d:this.prop("scopeName"))!==void 0&&c!==null&&c!=="HTML"))return function(a,b){if(a!=null)return;b.appendChild(document.createElement("br")),b.appendChild(document.createElement("br"))};if((e=this.css("display"))==="block"||e==="list-item"||e==="table-row")return function(b,c){var d;if(b!=null)return;d=c.lastChild;while(d!=null&&d.nodeType===3&&/^\s*$/.test(d.data))d=d.previousSibling;a(d).is("br")||c.appendChild(document.createElement("br"))}},init:function(){return a("head").append("<style>\t\t\t#"+this.prop("id")+" p {\t\t\t\tmargin-top: 0;\t\t\t\tmargin-bottom: 0;\t\t\t}\t\t</style>")},change:function(){var b;if(a(this).find("div, p").length>0)return b=rangy.saveSelection(),a(this).find("div").each(function(){var b;return b=a(this)[0].previousSibling,b!=null&&!a(b).is("br")&&a(this).before("<br>"),a(this).domSplice()}),a(this).find("p").each(function(){var b;return(((b=a(this)[0].previousSibling)!=null?b.nodeType:void 0)!==1||!a(this).prev().is("br"))&&a(this).after("<br>"),a(this).domSplice()}),rangy.restoreSelection(b)}}}.call(this),function(){var a;a=jQuery,a.htmleditable.singleline={condition:["-multiline"],init:function(){return this.bind("keydown","return",function(a){return a.preventDefault()})}}}.call(this),function(){var a;a=jQuery,a.htmleditable.base={input:function(a){return a.replace(/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,"")}}}.call(this),function(){var a,b,c;a=jQuery,b=void 0,c=function(){var c,d;return b!=null?b:(c=a('<div contenteditable="true" tabindex="-1" style="position: absolute; top: -100px; left: -100px; width: 1px; height: 1px; overflow: hidden;">text</div>').prependTo("body"),d=rangy.createRange(),d.selectNodeContents(c[0]),rangy.getSelection().setSingleRange(d),document.execCommand("bold",null,null),b=c.children()[0].nodeName,c.remove(),b!=null?b:"b")},a.htmleditable.bold={element:function(b,d){if(this.length===0||b!=null)return;if(this.is("strong, b"))return document.createElement(c());if(this.is(":header")&&a(d.childNodes).filter(c()).length===0)return function(b,d){var e,f,g;if(a(b).is(":header"))return;e=document.createElement(c()),f=d.lastChild;while(f!=null){g=f.previousSibling;if(e.hasChildNodes()||!a(f).is("br")&&(f.nodeType!==3||!/^\s*$/.test(f.data)))e.hasChildNodes()||d.insertBefore(e,f),e.insertBefore(f,e.firstChild);f=g}}},output:function(a){return a.find(c()).domSplice("<strong />")},state:function(){return a(this).htmleditable("selection")==null?null:document.queryCommandState("bold")},hotkeys:{"ctrl+b meta+b":[]},command:function(){return document.execCommand("bold",null,null)}}}.call(this),function(){var a;a=jQuery,a.htmleditable.link={element:function(a){var b;if(this.length===0||a!=null)return;if(this.is('a[href^="http://"]'))return b=document.createElement("a"),b.setAttribute("href",this.attr("href")),b},init:function(){},state:function(){var b;return b=a(this).htmleditable("selection"),b==null?null:a(b.collapsed?b.commonAncestorContainer:b.getNodes()).closest("a").get()},command:function(b){var c;c=a(this).htmleditable("selection");if(c==null)return;b==null&&(b="http://");if(!c.collapsed)return document.execCommand("createLink",null,b);try{return document.execCommand("insertHTML",null,'<a href="'+b+'">'+b+"</a>")}catch(d){}}}}.call(this),function(){var a;a=jQuery,a.htmleditable.list={element:function(b,c){var d,e,f,g,h,i,j,k,l,m;if(!this.is("ul, ol")){f=document.createElement("ul"),e=c.firstChild;while(e!=null)d=a(e),h=e.nextSibling,d.is("li")?(f.hasChildNodes()||c.insertBefore(f,e),f.appendChild(e),d.html(d.html().replace(/^\S\.?(?:&nbsp;)+([\s\S]+)$/,"$1"))):f.hasChildNodes()&&(e.nodeType===3&&/^\s*$/.test(e.data)?c.removeChild(e):f=document.createElement("ul")),e=h}if(this.length===0)return;m=(k=(l=this.attr("class"))!=null?l.split(" "):void 0)!=null?k:[];for(i=0,j=m.length;i<j;i++){g=m[i];if(/^MsoListParagraph\S*$/.test(g))return document.createElement("li")}if(b!=null)return;if(this.is("ul, ol, li"))return document.createElement(this.prop("nodeName"))},state:function(){return a(this).htmleditable("selection")==null?null:{orderedList:document.queryCommandState("insertOrderedList"),unorderedList:document.queryCommandState("insertUnorderedList")}},command:function(a){return console.log("command: list",a),document.execCommand("insert"+(a?"Ordered":"Unordered")+"List")}}}.call(this);